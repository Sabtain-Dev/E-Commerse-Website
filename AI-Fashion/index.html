<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Style Quiz | AI Fashion Project</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    
    <!-- Favicon -->
    <link rel="icon" href="icons/icon.png" type="image/png">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .quiz-option {
            transition: all 0.3s ease;
        }
        
        .quiz-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        
        .from-shop .hero-content {
            background: linear-gradient(to right, #7c3aed, #ec4899);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <!-- Check if coming from shop -->
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('from') && urlParams.get('from') === 'shop') {
            document.body.classList.add('from-shop');
        }
    </script>

    <!-- Main Container -->
    <div class="w-full max-w-4xl mx-auto">
        <!-- Header with Back Button -->
        <div class="flex justify-between items-center mb-6">
            <button onclick="goBackToShop()" class="back-to-shop-btn bg-white text-purple-600 font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-gray-100 transition flex items-center">
                <i class="fas fa-arrow-left mr-2"></i> Back to Shop
            </button>
            <h1 class="text-4xl md:text-5xl font-bold text-white">StyleSense AI</h1>
            <div class="w-28"></div> <!-- Spacer for balance -->
        </div>

        <!-- Hero Section -->
        <section class="hero-content glass-card p-8 md:p-10 mb-8 text-center transition-all duration-500">
            <div class="floating text-6xl mb-6">ðŸ‘—</div>
            <h2 class="text-3xl font-bold text-white mb-4">Discover Your Perfect Style</h2>
            <p class="text-white text-lg mb-6 max-w-2xl mx-auto">
                Take our personalized style quiz and get AI-powered recommendations tailored just for you!
            </p>
            <button id="startQuizBtn" class="pulse-animation bg-white text-purple-600 font-bold px-8 py-4 rounded-full text-lg shadow-lg hover:bg-gray-100 transition-all duration-300">
                Start Your Style Journey
            </button>
        </section>

        <!-- Features Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="glass-card p-6 text-center">
                <div class="text-3xl text-white mb-4">ðŸŽ¯</div>
                <h3 class="text-white font-semibold mb-2">Personalized</h3>
                <p class="text-white text-sm opacity-80">Recommendations based on your unique preferences</p>
            </div>
            
            <div class="glass-card p-6 text-center">
                <div class="text-3xl text-white mb-4">âš¡</div>
                <h3 class="text-white font-semibold mb-2">Quick</h3>
                <p class="text-white text-sm opacity-80">Only 5 questions to your perfect style</p>
            </div>
            
            <div class="glass-card p-6 text-center">
                <div class="text-3xl text-white mb-4">ðŸ¤–</div>
                <h3 class="text-white font-semibold mb-2">AI-Powered</h3>
                <p class="text-white text-sm opacity-80">Advanced algorithms for accurate results</p>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="glass-card p-6 text-center">
            <div class="flex justify-center space-x-10">
                <div>
                    <div class="text-2xl font-bold text-white">10K+</div>
                    <div class="text-white text-sm opacity-80">Users</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-white">95%</div>
                    <div class="text-white text-sm opacity-80">Satisfaction</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-white">5min</div>
                    <div class="text-white text-sm opacity-80">Average Time</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= Quiz Modal ================= -->
    <div id="quizModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white w-full max-w-2xl p-6 rounded-2xl shadow-xl">
            <div class="flex justify-between items-center mb-4">
                <h3 id="quizQuestionNumber" class="text-xl font-bold">Question <span id="currentQ">1</span> of <span id="totalQ">5</span></h3>
                <div class="w-1/2 bg-gray-200 rounded-full h-2.5">
                    <div id="quizProgress" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
            
            <p id="quizQuestion" class="text-lg mb-6 font-medium text-center">Loading question...</p>
            
            <div id="quizOptions" class="space-y-3"></div>
            
            <div id="quizImageOptions" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-6 hidden"></div>
            
            <div class="mt-8 flex justify-between">
                <button id="prevQuestion" class="text-blue-600 hover:text-blue-800 font-medium hidden">
                    <i class="fas fa-arrow-left mr-2"></i> Previous
                </button>
                <div>
                    <button id="closeQuiz" class="text-gray-500 hover:text-gray-800 mr-4">
                        <i class="fas fa-times mr-2"></i> Close
                    </button>
                    <button id="nextQuestion" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg hidden">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= AI Loading Modal ================= -->
    <div id="loadingModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-xl text-center">
            <div class="relative w-24 h-24 mx-auto mb-6">
                <div class="absolute inset-0 bg-blue-100 rounded-full animate-ping"></div>
                <div class="absolute inset-2 bg-blue-200 rounded-full flex items-center justify-center">
                    <i class="fas fa-robot text-blue-600 text-3xl"></i>
                </div>
            </div>
            <p class="text-lg font-semibold text-gray-800 mb-2">Analyzing your style preferences...</p>
            <p class="text-gray-600 text-sm">We're curating products that match your unique taste</p>
            <div class="w-full bg-gray-200 rounded-full h-2 mt-6">
                <div id="loadingProgress" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- ================= Results Modal ================= -->
    <div id="resultModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-xl text-center">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-green-600 text-3xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">ðŸŽ‰ Your Style Profile is Ready!</h3>
            <p class="text-gray-600 mb-6">We've found products that match your unique style preferences.</p>
            
            <div id="styleTags" class="flex flex-wrap justify-center gap-2 mb-6">
                <!-- Style tags will be inserted here -->
            </div>
            
            <div class="flex flex-col sm:flex-row gap-3 justify-center">
                <button id="retakeQuiz" class="border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition">
                    <i class="fas fa-redo mr-2"></i> Retake Quiz
                </button>
                <button id="seeProductsBtn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-shopping-bag mr-2"></i> See Your Products
                </button>
            </div>
            
            <!-- Back to Shop Button in Results Modal -->
            <div class="mt-6 pt-4 border-t border-gray-200">
                <button onclick="goBackToShop()" class="text-purple-600 hover:text-purple-800 font-medium flex items-center justify-center mx-auto">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Shop
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
    // Function to go back to shop page
    function goBackToShop() {
        // Add a nice transition effect
        document.body.style.opacity = '0.7';
        document.body.style.transition = 'opacity 0.3s ease';
        
        setTimeout(() => {
            window.location.href = 'shop.html';
        }, 300);
    }

    // ========================== Enhanced Quiz Data ==========================
    const quizData = {
      questions: [
        {
          id: "style",
          question: "Which style best describes your fashion preference?",
          type: "image",
          options: [
            { text: "Casual", value: "casual", image: "https://images.unsplash.com/photo-1552374196-1ab2a1c593e8?w=300&h=300&fit=crop", weight: 1.2 },
            { text: "Bohemian", value: "boho", image: "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=300&h=300&fit=crop", weight: 1.0 },
            { text: "Minimalist", value: "minimalist", image: "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=300&h=300&fit=crop", weight: 1.1 },
            { text: "Classic", value: "classic", image: "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=300&h=300&fit=crop", weight: 1.3 },
            { text: "Edgy", value: "edgy", image: "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=300&h=300&fit=crop", weight: 0.9 },
            { text: "Romantic", value: "romantic", image: "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=300&h=300&fit=crop", weight: 0.8 }
          ],
          nextQuestion: {
            "casual": "color",
            "boho": "color",
            "minimalist": "color",
            "classic": "occasion",
            "edgy": "color",
            "romantic": "color"
          }
        },
        {
          id: "color",
          question: "What's your preferred color palette?",
          type: "text",
          options: [
            { text: "Neutrals (black, white, beige)", value: "neutrals", weight: 1.1 },
            { text: "Bright & Bold", value: "bright", weight: 0.9 },
            { text: "Pastels", value: "pastels", weight: 1.0 },
            { text: "Earth Tones", value: "earth", weight: 1.2 },
            { text: "Jewel Tones", value: "jewel", weight: 1.0 }
          ],
          nextQuestion: "occasion"
        },
        {
          id: "occasion",
          question: "What do you shop for most often?",
          type: "text",
          options: [
            { text: "Work/Office", value: "work", weight: 1.3 },
            { text: "Everyday Wear", value: "everyday", weight: 1.1 },
            { text: "Special Occasions", value: "special", weight: 0.8 },
            { text: "Weekend/Relaxed", value: "weekend", weight: 1.0 },
            { text: "Athleisure", value: "athleisure", weight: 0.9 }
          ],
          nextQuestion: "budget"
        },
        {
          id: "budget",
          question: "What's your typical budget for clothing items?",
          type: "text",
          options: [
            { text: "Budget-friendly ($)", value: "low", weight: 0.8 },
            { text: "Mid-range ($$)", value: "mid", weight: 1.1 },
            { text: "Premium ($$$)", value: "high", weight: 1.3 },
            { text: "Mix of price points", value: "mixed", weight: 1.0 }
          ],
          nextQuestion: "accessories"
        },
        {
          id: "accessories",
          question: "What's your must-have accessory?",
          type: "text",
          options: [
            { text: "Bags", value: "bags", weight: 1.0 },
            { text: "Jewelry", value: "jewelry", weight: 1.1 },
            { text: "Shoes", value: "shoes", weight: 1.2 },
            { text: "Hats", value: "hats", weight: 0.9 },
            { text: "Scarves", value: "scarves", weight: 0.8 },
            { text: "None", value: "none", weight: 0.7 }
          ],
          nextQuestion: null
        }
      ],
      styleTags: {
        "casual": ["Relaxed", "Comfortable", "Easy-going"],
        "boho": ["Free-spirited", "Eclectic", "Artistic"],
        "minimalist": ["Clean", "Simple", "Sophisticated"],
        "classic": ["Timeless", "Elegant", "Polished"],
        "edgy": ["Bold", "Urban", "Trendy"],
        "romantic": ["Feminine", "Delicate", "Soft"],
        "neutrals": ["Versatile", "Chic", "Modern"],
        "bright": ["Energetic", "Playful", "Confident"],
        "pastels": ["Soft", "Sweet", "Gentle"],
        "earth": ["Natural", "Organic", "Warm"],
        "jewel": ["Rich", "Luxurious", "Deep"],
        "work": ["Professional", "Tailored", "Put-together"],
        "everyday": ["Versatile", "Practical", "Essential"],
        "special": ["Glamorous", "Dressy", "Statement"],
        "weekend": ["Relaxed", "Comfy", "Easy"],
        "athleisure": ["Sporty", "Active", "Modern"],
        "low": ["Budget-savvy", "Value-conscious", "Smart"],
        "mid": ["Quality-focused", "Balanced", "Curated"],
        "high": ["Luxury", "Investment", "Premium"],
        "mixed": ["Varied", "Selective", "Thoughtful"],
        "bags": ["Practical", "Organized", "Complete"],
        "jewelry": ["Detailed", "Accented", "Finished"],
        "shoes": ["Grounded", "Stylish", "Foundation"],
        "hats": ["Playful", "Sun-safe", "Top-off"],
        "scarves": ["Versatile", "Layered", "Cozy"],
        "none": ["Essential", "Minimal", "Streamlined"]
      }
    };

    // ========================== Quiz State Management ==========================
    let quizState = {
      currentQuestionId: "style",
      answers: {},
      questionOrder: ["style"],
      productMatches: [],
      maxQuestions: 5
    };

    // ========================== DOM Elements ==========================
    const quizModal = document.getElementById("quizModal");
    const questionEl = document.getElementById("quizQuestion");
    const optionsEl = document.getElementById("quizOptions");
    const imageOptionsEl = document.getElementById("quizImageOptions");
    const questionNumberEl = document.getElementById("quizQuestionNumber");
    const currentQEl = document.getElementById("currentQ");
    const totalQEl = document.getElementById("totalQ");
    const quizProgressEl = document.getElementById("quizProgress");
    const loadingModal = document.getElementById("loadingModal");
    const loadingProgressEl = document.getElementById("loadingProgress");
    const resultModal = document.getElementById("resultModal");
    const styleTagsEl = document.getElementById("styleTags");
    const prevQuestionBtn = document.getElementById("prevQuestion");
    const nextQuestionBtn = document.getElementById("nextQuestion");
    const closeQuizBtn = document.getElementById("closeQuiz");
    const retakeQuizBtn = document.getElementById("retakeQuiz");

    // ========================== Quiz Functions ==========================
    function startQuiz() {
      resetQuiz();
      quizModal.classList.remove("hidden");
      loadQuestion(quizState.currentQuestionId);
    }

    function resetQuiz() {
      quizState = {
        currentQuestionId: "style",
        answers: {},
        questionOrder: ["style"],
        productMatches: [],
        maxQuestions: 5
      };
      updateProgress();
    }

    function loadQuestion(questionId) {
      const question = quizData.questions.find(q => q.id === questionId);
      if (!question) return;
      
      quizState.currentQuestionId = questionId;
      questionEl.textContent = question.question;
      optionsEl.innerHTML = "";
      imageOptionsEl.innerHTML = "";
      
      // Update question counter
      const currentIndex = quizState.questionOrder.indexOf(questionId);
      currentQEl.textContent = currentIndex + 1;
      totalQEl.textContent = quizState.maxQuestions;
      updateProgress();
      
      // Show/hide navigation buttons
      prevQuestionBtn.classList.toggle("hidden", currentIndex === 0);
      nextQuestionBtn.classList.add("hidden");
      
      // Load question options based on type
      if (question.type === "image") {
        imageOptionsEl.classList.remove("hidden");
        optionsEl.classList.add("hidden");
        
        question.options.forEach(opt => {
          const div = document.createElement("div");
          div.className = "cursor-pointer group";
          div.innerHTML = `
            <div class="aspect-square overflow-hidden rounded-lg border-2 border-transparent group-hover:border-blue-300 transition">
              <img src="${opt.image}" alt="${opt.text}" class="w-full h-full object-cover">
            </div>
            <p class="text-sm font-medium mt-1 text-center">${opt.text}</p>
          `;
          div.addEventListener("click", () => handleAnswer(opt.value, question));
          imageOptionsEl.appendChild(div);
        });
      } else {
        imageOptionsEl.classList.add("hidden");
        optionsEl.classList.remove("hidden");
        
        question.options.forEach(opt => {
          const btn = document.createElement("button");
          btn.className = "quiz-option w-full text-left bg-gray-50 hover:bg-blue-50 border border-gray-200 py-3 px-4 rounded-lg transition";
          btn.textContent = opt.text;
          btn.addEventListener("click", () => handleAnswer(opt.value, question));
          optionsEl.appendChild(btn);
        });
      }
    }

    function handleAnswer(answer, question) {
      // Store answer with weight
      quizState.answers[question.id] = {
        value: answer,
        weight: question.options.find(opt => opt.value === answer)?.weight || 1.0
      };

      // Determine the next question
      let nextQuestionId;
      if (typeof question.nextQuestion === 'object') {
        nextQuestionId = question.nextQuestion[answer];
      } else {
        nextQuestionId = question.nextQuestion;
      }

      // End the quiz immediately if there's no next question
      if (!nextQuestionId) {
        finishQuiz();
        return;
      }

      // Add the next question to the order if not already in it
      if (!quizState.questionOrder.includes(nextQuestionId)) {
        quizState.questionOrder.push(nextQuestionId);
      }

      // End quiz if we've already reached the fixed max number of questions
      if (quizState.questionOrder.length >= quizState.maxQuestions) {
        finishQuiz();
        return;
      }

      // Load the next question
      loadQuestion(nextQuestionId);
    }

    function updateProgress() {
      const currentIndex = quizState.questionOrder.indexOf(quizState.currentQuestionId);
      const progress = ((currentIndex + 1) / quizState.maxQuestions) * 100;
      quizProgressEl.style.width = `${progress}%`;
    }

    function finishQuiz() {
      quizModal.classList.add("hidden");
      showLoadingAndResults();
    }

    function showLoadingAndResults() {
      loadingModal.classList.remove("hidden");
      
      // Simulate AI processing with progress animation
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress >= 100) {
          clearInterval(interval);
          loadingModal.classList.add("hidden");
          showResults();
        }
        loadingProgressEl.style.width = `${Math.min(progress, 100)}%`;
      }, 300);
    }

    function showResults() {
      // Generate style tags based on answers
      const styleTags = [];
      for (const [key, answer] of Object.entries(quizState.answers)) {
        if (quizData.styleTags[answer.value]) {
          styleTags.push(...quizData.styleTags[answer.value]);
        }
      }
      
      // Remove duplicates and limit to 6 tags
      const uniqueTags = [...new Set(styleTags)].slice(0, 6);
      
      // Display tags
      styleTagsEl.innerHTML = uniqueTags.map(tag => 
        `<span class="bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full">${tag}</span>`
      ).join("");
      
      // Save answers to session storage
      sessionStorage.setItem("styleQuizAnswers", JSON.stringify(quizState.answers));
      
      resultModal.classList.remove("hidden");
    }

    function goToPreviousQuestion() {
      const currentIndex = quizState.questionOrder.indexOf(quizState.currentQuestionId);
      if (currentIndex > 0) {
        loadQuestion(quizState.questionOrder[currentIndex - 1]);
      }
    }

    // ========================== Event Listeners ==========================
    document.getElementById("startQuizBtn").addEventListener("click", startQuiz);
    closeQuizBtn.addEventListener("click", () => {
      quizModal.classList.add("hidden");
    });
    prevQuestionBtn.addEventListener("click", goToPreviousQuestion);
    retakeQuizBtn.addEventListener("click", () => {
      resultModal.classList.add("hidden");
      startQuiz();
    });

    // See Products button â†’ go to personalized page
    document.getElementById("seeProductsBtn").addEventListener("click", () => {
      window.location.href = "personalized.html";
    });

    // Debug initialization
    console.log("Quiz initialized");
    </script>
</body>
</html>